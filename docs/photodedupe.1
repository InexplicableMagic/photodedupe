.\"t
.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "" "" "" "" ""
.hy
.SH NAME
.PP
photodedupe - a command line utility for identifying duplicate photos
.SH SYNOPSIS
.PP
photodedupe [-d|-u|-a] [DIR]
.SH DESCRIPTION
.PP
Photodedupe is a command line utility for identifying duplicate photos
regardless of whether the images have been scaled or have differing file
formats.
It compares the image content visually and does not rely on metadata or
file hashes to perform the de-duplication.
.PP
Where duplicates are identified, the images are sorted by resolution
such that the largest version of each image appears first.
It is possible to list only the highest resolution versions of all
images, or alternatively to list only the duplicates (lower resolution
versions).
This enables the best copies of images to be extracted from a photo
collection or the duplicates to be removed.
This sort order is helpful for applications such as removing thumbnails
from image collections or separating scaled web resolution images from
the original high resolution version.
.PP
The output is a list of file paths that can be piped to other commands
such that the required images can be sorted into folders (example usage
below).
Photodedupe can work with large image collections of hundreds of
thousands or millions of images and scales to any number of CPU cores.
.SH OPTIONS
.PP
\f[B]-d, --duplicates\f[R]
.PD 0
.P
.PD
List only the detected duplicate images.
Excludes the highest resolution version of each image.
Excludes unique images
.PP
\f[B]-u, --uniques\f[R]
.PD 0
.P
.PD
List only the best (highest resolution) version of each valid image
without listing any duplicates
.PP
\f[B]-a, --all\f[R]
.PD 0
.P
.PD
By default photodedupe lists only images that have duplicates.
This option causes all valid image files to be listed (except those
below the minimum resolution if --min-resolution is used) regardless of
whether the file has a duplicate
.PP
\f[B]-c, --compare <directory of new images>\f[R]
.PD 0
.P
.PD
Compares a directory of new images (supplied as the parameter to
--compare) with one or more directories comprising an existing image
collection (supplied as arguments).
Tests whether each of the new images are duplicates of the existing
image collection or unique depending on use of either the --duplicates
or --uniques options respectively.
When used with --duplicates, new images are classified as unique when of
higher resolution than the version in the existing image collection.
To mark similar images as duplicates in all circumstances (irrespective
of resolution), additionally apply the --ignore-resolution option
.PP
\f[B]--ignore-resolution\f[R]
.PD 0
.P
.PD
When using --compare always mark duplicates even the new image is better
quality.
Do not mark as unique even if better quality
.PP
\f[B]--min-resolution <WidthxHeight>\f[R]
.PD 0
.P
.PD
Ignore all images of less than the specified resolution
e.g.\ --min-resolution 300x200 will ignore images if either the width is
less than 300 pixels or the height is less than 200 pixels
.PP
\f[B]-y, --any-file\f[R]
.PD 0
.P
.PD
Tests every file to see if it might be an image regardless of file
extension.
Also allows image files with no extension.
The default behaviour is to only test files with common image filename
extensions which are jpg,jpeg,png,tif,tiff,gif and webp
.PP
\f[B]--force-colour-diff-only\f[R]
.PD 0
.P
.PD
Only use the colour difference algorithm.
This is more accurate but does not perform well with large numbers of
images.
This algorithm is used by default with 50,000 or fewer images.
Beyond this number of images, a different perceptual hash algorithm is
used than is slightly less accurate but is much faster.
.PP
\f[B]-t, --threads <number of threads>\f[R]
.PD 0
.P
.PD
Number of CPU threads to use (default is 4).
Higher number improves performance if more than 4 CPU threads are
available
.PP
\f[B]--colour-diff-threshold <threshold>\f[R]
.PD 0
.P
.PD
Colour difference threshold.
Higher value means more likely to consider images duplicates
(Min:0,Max:49000,Default:256)
.PP
\f[B]-g, --debug\f[R]
.PD 0
.P
.PD
Expects either one or two image file arguments.
Where one file is supplied, prints statistics about the file.
Where two are supplied prints statistics and information about the
differences found between the files
.PP
\f[B]-h, --help\f[R]
.PD 0
.P
.PD
Print help
.PP
\f[B]-V, --version\f[R]
.PD 0
.P
.PD
Print version
.SH EXAMPLE USAGE
.PP
One or more directories can be supplied on the command line and
photodedupe will recursively inspect all of them for images:
.IP
.nf
\f[C]
photodedupe dir_of_images_1/ dir_of_images_2/ dir_of_images_3/
\f[R]
.fi
.PP
A list of specific image files can be supplied as arguments:
.IP
.nf
\f[C]
photodedupe image1.jpg image2.jpg image3.jpg
\f[R]
.fi
.PP
Or a list of file paths can be piped in.
This method can be used to select only images of a certain format by
file extension:
.IP
.nf
\f[C]
find dir_of_photos/ -name \[aq]*.jpg\[aq] | photodedupe
\f[R]
.fi
.PP
By default photodedupe will only inspect files with common image
filename extensions.
JPEG, PNG, TIFF, GIF and WebP images are supported.
The extension check also applies when lists of files are piped in on
stdin.
However, if your images do not have appropriate filename extensions,
image file formats can also be auto-detected.
To inspect every file regardless of extension (or lack of extension) and
determine if each may be an image, use the \f[C]--any-file\f[R] option.
.PP
The default output only lists images that have duplicates.
The highest resolution version will be listed first as the
\[lq]best\[rq] copy, followed by any lower resolution versions listed as
duplicates.
If there are no duplicates there will be no output on stdout.
.IP
.nf
\f[C]
Best(512x341): unit_test_images/cat2_best.jpg
    Duplicate(510x340): unit_test_images/cat2_duplicate_1.jpg
    Duplicate(100x67): unit_test_images/cat2_duplicate_2.png
\f[R]
.fi
.PP
To list every image file found regardless of whether it has a duplicate
use the \f[C]--all\f[R] option.
.PP
To list only the highest resolution version of each image use the
\f[C]--uniques\f[R] option.
The output will include images that do not have any duplicates.
This option could be used to copy the highest resolution version of each
image to a different directory.
.PP
In this example photodedupe is outputting a list of filenames of the
best versions of each image on stdout.
The xargs command reads each filename, substitues it for the two braces
and executes the provided command.
This then causes each listed file to be copied to the specified
directory.
.PP
\f[C]photodedupe --uniques dir_of_photos/ | xargs -i cp \[dq]{}\[dq] unique_best_versions_dir/\f[R]
.PP
To list only the lower resolution duplicate images, use the
\f[C]--duplicates\f[R] option.
This option could be used to remove duplicates from a directory e.g:
.PP
\f[C]photodedupe --duplicates dir_of_photos/ | xargs -i mv \[dq]{}\[dq] duplicate_photos_dir/\f[R]
.PP
Note that photodedupe is performing a fuzzy match and is not 100%
accurate.
It is not advised to delete duplicates without manual inspection.
.PP
Photos below a user specified resolution can be ignored.
In the following example photos will not be inspected that have either a
width of less than 150 pixels or a height of less than 100 pixels.
This option can be helpful if e.g.\ a web page of high resolution photos
has been downloaded but the directory also includes a variety of other
images present on the page that are not required such as navigation
button images etc.
The button images will tend to be lower resolution than the required
photos and so they can be immediately filtered out with this option.
.PP
\f[C]photodedupe dir_of_photos/ --min-resolution 150x100\f[R]
.SS IMAGE DIRECTORY DIFF
.PP
The feature enables a directory of new images to be compared against a
pre-existing collection of photos to determine if any of the new images
already appear in the collection.
This can be used to update a photo collection with new unique images
derived from a new source.
An example application might be for use with a web scraper that
periodically downloads all the images from a regularly updated web page.
This option can be used to determine if any of the most recently
downloaded images are new or if they were downloaded on a previous
occasion.
.PP
To identify which of the new images already exist in your collection
pass the directory of new images to be tested to the \f[C]--compare\f[R]
option, then supply one or more paths to the pre-existing photo
collection as arguments.
.PP
Supply the \f[C]--uniques\f[R] flag to show which images in
new_images_dir are unique with respect the existing collection.
You might then move the new images found into your collection.
.PP
\f[C]photodedupe --uniques --compare new_images_dir/ collection_of_existing_images/\f[R]
.PP
Supply the \f[C]--duplicates\f[R] flag to show which images in the
new_images_dir are duplicates of the existing collection.
If photos in the new images directory already exist in the collection at
the same or lower resolution, the new images will be reported as
duplicates.
If however a photo appears in the new images directory at a higher
resolution than present in the collection, it will not be reported as a
duplicate.
This is to enable better quality versions of existing images to be
discovered and added to the collection.
This means you may be adding duplicates to the collection, but the
duplicates added will be better quality versions of images than the
versions you already have.
If you do not want this behaviour and you would like duplicates to be
reported in all circumstances, even if the new image is higher
resolution, additionally supply the \f[C]--ignore-resolution\f[R] flag.
.PP
\f[C]photodedupe --duplicates --compare new_images_dir/ collection_of_existing_images/\f[R]
.PP
The new images directory passed to \f[C]--compare\f[R] is inspected
recursively and sub-directories will also be inspected for images.
The same rules apply as for other directories.
By default only files with common image file name extensions (such as
\&.jpg) will be inspected unless the \f[C]--any-file\f[R] option is used
where all files will be inspected.
.PP
It is also possible to specify a single specific image file to be
compared against the entire existing photo collection.
This can be used to effectively perform a database query to ask the
question as to if you already have this specific image in your
collection or not.
.PP
\f[C]photodedupe --duplicates --compare image.jpg collection_of_existing_images/\f[R]
.PP
When using \f[C]--compare\f[R], any duplicates present in the existing
collection are not reported.
Only duplicates present in the new images directory are reported.
Reporting images found in the collection is just the default behaviour,
in which case simply do not use the \f[C]--compare\f[R] option at all
and pass the new images directory as a regular argument together with
the existing photo collection.
.PP
To determine where specifically the images in the new images directory
appear in the existing photo collection use the \f[C]--compare\f[R]
option alone (without either the \f[C]--duplicates\f[R] or
\f[C]--uniques\f[R] flag).
This will show only instances where there is a duplicate of an image in
the new images directory.
Only the highest resolution version will be shown from the collection
(unless the version in the new images directory is the best version).
.SS EXAMPLE BEHAVIOUR OF --compare
.PP
In the example below the directory \[lq]new_images\[rq] is passed to the
\f[C]--compare\f[R] option and the \f[C]--duplicates\f[R] flag is used.
The existing_collection directory is passed as an argument.
All of the images in the below table are visually duplicates of each
other:
.PP
.TS
tab(@);
l l l.
T{
File
T}@T{
Resolution
T}@T{
Shown As Duplicate?
T}
_
T{
new_images/image_dupe_1.jpg
T}@T{
5 MP
T}@T{
No
T}
T{
existing_collection/image_dupe_2.jpg
T}@T{
4 MP
T}@T{
No
T}
T{
new_images/image_dupe_3.jpg
T}@T{
3 MP
T}@T{
Yes
T}
T{
existing_collection/image_dupe_4.jpg
T}@T{
2 MP
T}@T{
No
T}
T{
existing_collection/image_dupe_5.jpg
T}@T{
1 MP
T}@T{
No
T}
.TE
.PP
Image_dupe_1 is not shown as a duplicate because at 5 megapixels it
exceeds the resolution of the best copy in the existing collection
(Image_dupe_2), which is only 4 MP.
Image_dupe_3 is displayed as a duplicate because at 3MP it is below the
resolution of the best copy in the existing collection.
Image_dupe_4 and Image_dupe_5 are not shown because they are in the
existing collection and not in the new images directory.
.SH PERFORMANCE
.PP
Photodedupe uses four threads by default to process images.
The number of threads can be increased using the \f[C]--threads\f[R]
option.
More than the specified number of threads may actually be used due to
further multithreading within the underlying libraries.
.PP
Up to 50,000 images, all photos found are compared to all others.
However after this number of images, the performance of this approach
starts to become intractable.
Photodedupe will then switch to a different algorithm that is less
capable of detecting duplicates but can handle much larger numbers of
images.
A warning will be printed to stderr to explain when this occurs.
It is possible to force use of the all to all comparison variation using
the \f[C]--force-colour-diff-only\f[R] flag.
However this is not advised for large image sets as the performance will
decline significantly.
.PP
Photodedupe is not as accurate on vector art or images containing little
variance such as very dark photos.
Images are tested for variance, where variance is below the threshold
where de-duplication is likely to be reliable the images are identified
as unique to prevent false positives.
.PP
Photodedupe does not detect transformations of images as duplicates.
If the image has been significantly rotated or cropped it will be
identified as unique.
.PP
The internal threshold at which a duplicate is detected can be be tuned
using the \f[C]--colour-diff-threshold\f[R] option which accepts an
integer between 0 and 49000.
The default threshold is 256.
Setting this value closer to zero will cause fewer duplicates to be
found.
At values close to 49000 virtually all images will be declared
duplicates.
.SH AUTHOR
.PP
Leon Bubb
.SH SOURCE
.PP
<https://github.com/InexplicableMagic/photodedupe>
.SH LICENSE
.PP
MIT (https://mit-license.org/)
